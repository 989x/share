# ขั้นตอนการตั้งค่าเงื่อนไขการจอง (StoreCondition)

StoreCondition ถูกเพิ่มเข้ามาเพราะระบบต้องรองรับ **เงื่อนไขการจองหลายรูปแบบ**  
ไม่ใช่ทุกบริการจะสามารถจองได้อย่างอิสระ บางครั้งบริการต่าง ๆ ต้องแชร์ทรัพยากรร่วมกัน  
เช่น ห้องนวด, ห้องตรวจ, หรือเตียงทำทรีตเมนต์  

ตัวอย่างเช่น:  
- **Exclusive Room** → ห้องนวด A จองได้ครั้งละ 1 เท่านั้น ไม่ว่าผู้ใช้เลือกบริการไหนที่ใช้ห้องนี้  
- **Shared Capacity** → เตียงทำทรีตเมนต์ 5 เตียง ทุกบริการที่ใช้เตียงนี้ต้องแชร์โควตาร่วมกัน  
- **Independent Service** → บริการที่จัดการ slot ของตัวเอง ไม่เกี่ยวข้องกับบริการอื่น  

ดังนั้น StoreCondition จึงเป็นส่วนสำคัญ ที่ช่วยให้ระบบ Admin Dashboard  
สามารถกำหนดกฎเหล่านี้ล่วงหน้าได้ และทำให้การแสดงผล Availability ฝั่งลูกค้า  
ถูกต้องตรงกับการใช้งานจริง  


## ลำดับการทำงาน

### Step 1: เข้าเมนู StoreCondition

* ผู้ใช้ Admin เข้าไปที่ **Store Management**
* เลือก **StoreCondition** (อาจอยู่ในเมนูย่อยของ Store หรือเป็นแท็บแยก)
* กดปุ่ม **“Create StoreCondition”**

### Step 2: เลือกร้าน (Store)

* ผู้ใช้เลือก **Store** ที่ต้องการสร้างเงื่อนไข
* (ระบบใช้ค่า `store_id` อ้างอิง)

### Step 3: เลือก Service ที่เกี่ยวข้อง

* แสดงรายการ **Service** ของ Store นั้น
* ผู้ใช้สามารถเลือก **1 หรือหลาย Services** ที่ต้องการให้อยู่ใน Condition นี้
* Note: ถ้า Service ถูกเลือก เงื่อนไขจะครอบคลุม **ทุก Sub-service** ของ Service นั้น

### Step 4: เลือกประเภทของเงื่อนไข (Condition Type)

* ผู้ใช้เลือก **Type** ของ StoreCondition (เลือกได้ 1 แบบ):

  1. **Exclusive Room** → จำกัดได้สูงสุด 1 Booking ต่อช่วงเวลา
  2. **Shared Capacity** → ใช้โควตาร่วมกัน (ต้องกำหนดจำนวน capacity ต่อ slot)
  3. **Independent Service** → ให้ Service/Sub-service จัดการตัวเองตามค่า `max_booking_per_slot`

### Step 5: กำหนดรายละเอียดเพิ่มเติม

* ถ้าเลือก **Shared Capacity** → ให้ระบุค่า **capacity\_per\_slot** (จำนวนจองสูงสุดต่อช่วงเวลา)
* ถ้าเลือก **Exclusive Room** → capacity ถูก fix = 1 (ไม่ต้องกรอกเพิ่ม)
* ถ้าเลือก **Independent Service** → ไม่มี field เพิ่มเติม

### Step 6: ตั้งค่า Group Key (บังคับให้ใส่)

* ผู้ใช้ **ต้องกรอกค่า Group Key** ทุกครั้ง เพื่อระบุชื่อกลุ่ม resource ที่เงื่อนไขนี้ควบคุม
* UX แนะนำให้เป็น **ข้อความที่อ่านง่าย และสื่อถึงความเป็นจริง** เช่น:

  * “ห้องนวด A”
  * “เตียงทำทรีตเมนต์ 2”
  * “ห้องตรวจทั่วไป”
* หลีกเลี่ยงรูปแบบที่เป็นโค้ด เช่น `ROOM_A` หรือ `BED_1` เพราะจะทำให้ผู้ใช้สับสน

### Step 7: บันทึก StoreCondition

* ผู้ใช้กด **Save/Confirm**
* ระบบทำการสร้าง StoreCondition (บันทึกลง DB)
* Admin Dashboard แสดงรายการ StoreCondition ที่เพิ่งสร้าง พร้อมรายละเอียด

### Step 8: ใช้งานใน Availability Flow

* เมื่อมีการสร้าง/แก้ไข StoreCondition แล้ว ระบบฝั่งลูกค้า (Customer Booking) จะถูกปรับตาม
* Availability จะสะท้อนผลของเงื่อนไข เช่น

  * Slot ถูก “จองหมด” เพราะ Service อื่นใน group ใช้ไปแล้ว (Exclusive Room)
  * Slot แสดง capacity ที่เหลือจาก pool (shared\_pool)
