# ลำดับการตรวจสอบความพร้อมของระบบจอง (Booking Availability Priority)

ไฟล์นี้อธิบายขั้นตอนและลำดับที่ระบบใช้ในการตรวจสอบก่อนอนุญาตให้ผู้ใช้ทำการจองได้จริง  
เพื่อให้ทีม UX/UI เข้าใจว่า **กว่าจะเห็น slot ว่างและสามารถกดจองได้ ระบบต้องตรวจสอบอะไรบ้าง และตรวจสอบตามลำดับใด**  

แนวคิดคือ ระบบไม่สามารถเปิดให้ผู้ใช้กดจองทันทีได้ แต่ต้องผ่านการเช็กหลายชั้น ได้แก่  
- ตรวจสอบความถูกต้องของข้อมูลที่ส่งเข้ามา  
- ตรวจสอบว่าสาขาและบริการที่เลือกยัง Active อยู่  
- ตรวจสอบวันหยุดที่ร้านหรือบริการกำหนดไว้  
- ตรวจสอบช่วงเวลา (timeline) ที่มีการเปิดให้บริการ  
- ตรวจสอบกฎการจองร่วมกัน (StoreCondition) เช่น ห้องเดียวใช้ได้ทีละครั้ง หรือแชร์โควตาร่วมกัน  
- ตรวจสอบการจองที่มีอยู่แล้วและการ hold slot ที่กำลังรอการยืนยัน  

เมื่อผ่านทั้งหมดแล้ว จึงสรุปออกมาเป็น **สถานะของแต่ละช่วงเวลา (Available / Held / Booked)**  
ซึ่งเป็นข้อมูลที่ฝั่ง UX/UI ต้องแสดงให้ลูกค้าเห็นอย่างถูกต้อง  


## ลำดับการทำงาน

### 1. ตรวจสอบข้อมูลที่ผู้ใช้ส่งมา
- ผู้ใช้ต้องเลือกบริการย่อย (Sub-service) และวันที่ที่ต้องการจอง  
- ถ้าไม่ได้เลือก หรือใส่ข้อมูลไม่ถูกต้อง ระบบจะหยุดทันที  

### 2. ตรวจสอบว่าบริการเปิดใช้งานอยู่
- ระบบจะตรวจสอบว่า:
  - สาขานั้นเปิดใช้งานอยู่  
  - บริการหลักเปิดใช้งานอยู่  
  - บริการย่อยที่เลือกเปิดใช้งานอยู่  
- ถ้าอันใดอันหนึ่งปิดใช้งาน → ผู้ใช้จะไม่สามารถจองได้  

### 3. ตรวจสอบวันหยุด
- ระบบจะดูว่าตรงกับวันหยุดของสาขาหรือบริการย่อยหรือไม่  
- ถ้าใช่ → วันนั้นจะไม่สามารถจองได้ (ช่องเวลาจะปิดทั้งหมด)  

### 4. สร้างตารางเวลาที่จองได้
- ระบบจะสร้าง “ช่องเวลา” (Time slots) ตามช่วงเวลาที่สาขาเปิดทำการ  
- เช่น เปิด 09:00 – 18:00 และบริการใช้เวลา 60 นาที  
  → จะได้ช่อง 09:00, 10:00, 11:00 … ไปจนถึง 17:00  

### 5. ตรวจสอบกติกาพิเศษของร้าน (Store Condition)
- ถ้าบริการย่อยใช้เวลา **60 นาที** จะมีการตรวจสอบกติกาพิเศษ เช่น:
  - **แบบห้องเดียว (Mutex)** → ห้องใช้ได้ทีละหนึ่งการจอง  
  - **แบบแชร์ห้อง (Shared Pool)** → ห้องหนึ่งสามารถให้หลายการจองพร้อมกัน แต่มีจำนวนจำกัด  
  - **แบบอิสระ (Independent)** → แต่ละบริการแยกกัน ไม่กระทบกัน  

### 6. ตรวจสอบจำนวนการจองที่มีอยู่แล้ว
- ระบบจะดูว่าช่องเวลานั้นมีการจองไปแล้วหรือยัง  
- การจองแบ่งเป็น 2 แบบ:
  - **จองจริง (Booked)** → มีลูกค้ายืนยันแล้ว  
  - **จองค้างไว้ (Hold)** → ลูกค้ากำลังทำรายการอยู่ แต่ยังไม่กดยืนยัน  

### 7. ตัดสินสถานะของแต่ละช่วงเวลา
- ถ้าจำนวนจองจริงเต็ม → ช่องเวลานั้น = **จองแล้ว (Booked)**  
- ถ้ายังไม่เต็ม แต่มีคนค้างอยู่ → ช่องเวลานั้น = **ถูกกันไว้ (Held)**  
- ถ้ายังว่าง → ช่องเวลานั้น = **พร้อมให้จอง (Available)**  

### 8. กันการจองชั่วคราว (Hold)
- เมื่อผู้ใช้เลือกช่วงเวลา → ระบบจะกันเวลาไว้ชั่วคราว  
- เพื่อป้องกันไม่ให้คนอื่นจองซ้ำในระหว่างที่ผู้ใช้กำลังทำรายการ  

### 9. ยืนยันการจอง (Finalize)
- ผู้ใช้เข้าสู่ระบบและยืนยันการจอง  
- ระบบจะตรวจสอบซ้ำอีกครั้งว่าช่องเวลายังว่างอยู่  
- ถ้าว่าง → สร้างการจองจริง (Booked)  
- ถ้าเต็มไปแล้ว → แจ้งผู้ใช้ว่าเกิดการจองซ้ำ  


## สรุป
1. ตรวจสอบข้อมูลที่กรอก  
2. ตรวจสอบว่าบริการเปิดใช้งานอยู่  
3. ตรวจสอบวันหยุด  
4. สร้างตารางเวลาที่เปิดให้จอง  
5. ตรวจสอบกติกาพิเศษ (ถ้ามี)  
6. ตรวจสอบจำนวนที่ถูกจองไปแล้ว  
7. ตัดสินสถานะของช่องเวลา  
8. กันการจองชั่วคราวเมื่อผู้ใช้เลือก  
9. ยืนยันการจองเมื่อผู้ใช้กดตกลง  


## สำหรับทีม UX/UI
- ถ้าวันนั้นเป็นวันหยุด ควรแสดงข้อความว่า **“ไม่เปิดทำการ”**  
- เมื่อผู้ใช้เลือกเวลา → ต้องแสดงสถานะ “ถูกกันไว้” ชั่วคราว  
- เมื่อยืนยันการจอง → เปลี่ยนเป็น “จองแล้ว”  
